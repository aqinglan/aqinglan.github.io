<!DOCTYPE html><html lang="zh-CN, en-US"><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content="IE=edge" http-equiv=X-UA-Compatible><title>4-处理器体系结构 • Akiのink</title><link href=/favicon/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/favicon/favicon-32x32.png rel=icon type=image/png sizes=32x32><link href=/favicon/favicon-16x16.png rel=icon type=image/png sizes=16x16><link href=/favicon/site.webmanifest rel=manifest><link href=/fonts/Satoshi-Variable.ttf rel=preload type=font/ttf as=font crossorigin><link href=/fonts/Satoshi-VariableItalic.ttf rel=preload type=font/ttf as=font crossorigin><link href=https://astro-theme-pure.vercel.app/blog/4-%E5%A4%84%E7%90%86%E5%99%A8%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84 rel=canonical><meta content="4-处理器体系结构 • Akiのink" name=title><meta content="对应 CSAPP 第四章节" name=description><meta content=Aki name=author><meta content="" name=theme-color><meta content=article property=og:type><meta content=4-处理器体系结构 property=og:title><meta content="对应 CSAPP 第四章节" property=og:description><meta content=https://astro-theme-pure.vercel.app/blog/4-%E5%A4%84%E7%90%86%E5%99%A8%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84 property=og:url><meta content=Akiのink property=og:site_name><meta content=en_US property=og:locale><meta content=https://astro-theme-pure.vercel.app/_astro/4.jgS8Kphi.png property=og:image><meta content=1200 property=og:image:width><meta content=630 property=og:image:height><meta content=Aki property=article:author><meta content=2023-02-18T04:00:00.000Z property=article:published_time><meta content=summary_large_image property=twitter:card><meta content=https://astro-theme-pure.vercel.app/blog/4-%E5%A4%84%E7%90%86%E5%99%A8%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84 property=twitter:url><meta content=4-处理器体系结构 property=twitter:title><meta content="对应 CSAPP 第四章节" property=twitter:description><meta content=https://astro-theme-pure.vercel.app/_astro/4.jgS8Kphi.png property=twitter:image><meta content=@cworld0_cn name=telegram:channel><link href=/sitemap-index.xml rel=sitemap><link href=https://astro-theme-pure.vercel.app/rss.xml rel=alternate type=application/rss+xml title=Akiのink><meta content="Astro v4.16.10" name=generator><link href=/styles/global.css rel=stylesheet><vercel-speed-insights data-params={&#34;slug&#34;:&#34;4-处理器体系结构&#34;} data-pathname=/blog/4-%E5%A4%84%E7%90%86%E5%99%A8%E4%BD%93%E7%B3%BB%E7%BB%93%E6%9E%84 data-props={}></vercel-speed-insights><script>console.log("%c Astro Theme Pure %c https://github.com/cworld1/astro-theme-pure/","color:#fff;background:linear-gradient(90deg,#448bff,#44e9ff);padding:5px 0;","color:#000;background:linear-gradient(90deg,#44e9ff,#ffffff);padding:5px 10px 5px 0px;")</script><link href=/_astro/_slug_.XaQ6XQsx.css rel=stylesheet><link href=/_astro/_slug_.BLJzc6jn.css rel=stylesheet><style>#waline[data-astro-cid-ksttp56e]{--waline-font-size:16px;--waline-white:hsl(var(--background) / var(--tw-bg-opacity));--waline-light-grey:#999;--waline-dark-grey:#666;--waline-theme-color:hsl(var(--foreground) / var(--tw-text-opacity));--waline-active-color:hsl(var(--primary) / var(--tw-text-opacity));--waline-color:hsl(var(--muted-foreground) / var(--tw-text-opacity));--waline-bg-color:hsl(var(--primary-foreground) / var(--tw-bg-opacity));--waline-bg-color-light:hsl(var(--input) / var(--tw-bg-opacity));--waline-bg-color-hover:#f0f0f0;--waline-border-color:hsl(var(--border) / var(--tw-border-opacity));--waline-disable-bg-color:#f8f8f8;--waline-disable-color:#bbb;--waline-code-bg-color:#282c34;--waline-bq-color:#f0f0f0;--waline-avatar-size:3.25rem;--waline-m-avatar-size:calc(var(--waline-avatar-size) * 9 / 13);--waline-badge-color:#3498db;--waline-badge-font-size:.775em;--waline-info-bg-color:var(--waline-bg-color-light);--waline-info-color:var(--waline-color);--waline-info-font-size:.625em;--waline-border:1px solid var(--waline-border-color);--waline-avatar-radius:50%;--waline-box-shadow:none}#waline[data-astro-cid-ksttp56e] .wl-reaction-title{display:none!important}#waline[data-astro-cid-ksttp56e] .wl-reaction{overflow:visible}#waline[data-astro-cid-ksttp56e] blockquote{position:relative;border-inline-start:4px solid transparent!important}#waline[data-astro-cid-ksttp56e] blockquote:before{content:"";height:100%;width:4px;left:-4px;top:0;position:absolute;border:2px solid var(--waline-bq-color)!important;border-radius:9999px}</style><link href=/_astro/_slug_.C639AhNv.css rel=stylesheet><script type=module src=/_astro/hoisted.B8nntUZK.js></script><script type=module src=/_astro/page.V2R8AmkL.js></script><script>window.va=window.va||function(){(window.vaq=window.vaq||[]).push(arguments)};var script=document.createElement("script");script.defer=!0,script.src="/_vercel/insights/script.js";var head=document.querySelector("head");head.appendChild(script)</script></head><body class="flex bg-background justify-center"><script>const lightModePref=window.matchMedia("(prefers-color-scheme: light)");function getUserPref(){return localStorage.getItem("theme")||(lightModePref.matches?"light":"dark")}function setTheme(e,t=!1){if(!["light","dark"].includes(e))return void console.log(`Invalid theme value '${e}' received. Expected 'light' or 'dark'.`);t&&localStorage.setItem("theme",e),document.documentElement.classList.toggle("dark","dark"===e);const r="dark"===e?"#0B0B10":"#FCFCFD";document.querySelector('meta[name="theme-color"]')?.setAttribute("content",r)}setTheme(getUserPref()),document.addEventListener("astro:after-swap",(()=>setTheme(getUserPref()))),document.addEventListener("theme-change",(e=>{const t=e.detail.theme;localStorage.setItem("theme",t),setTheme(e.detail.theme,!0)})),lightModePref.addEventListener("change",(e=>{setTheme(e.matches?"light":"dark")}))</script><main class="flex items-center flex-col leading-relaxed lg:px-10 max-w-[60rem] min-h-screen pb-10 px-4 sm:px-7 text-[0.92rem] w-screen z-10"><header-component class="transition-all py-1 border group [&#38;.not-top]:bg-background [&#38;.not-top]:border-border border-transparent box-content dark:[&#38;.not-top]:bg-primary-foreground duration-300 mb-16 rounded-xl sm:rounded-2xl sticky top-4 w-full z-30" data-astro-cid-qlfjksao><header class="flex flex-wrap sm:flex-nowrap sm:justify-start text-sm" data-astro-cid-qlfjksao><nav aria-label=global class="flex items-center justify-between mx-auto relative sm:flex sm:items-center w-full" data-astro-cid-qlfjksao><div class="hidden -left-4 -z-10 absolute box-content dark:max-sm:group-[.expanded]:bg-primary-foreground max-sm:group-[.expanded.not-top]:hidden max-sm:group-[.expanded]:block w-[calc(100%+2rem)] !duration-0 -top-8 h-20 max-sm:group-[.expanded]:bg-white" data-astro-cid-qlfjksao></div><a href=/ class="transition-all duration-300 flex-none font-semibold group-[.not-top]:ms-3 sm:group-[.not-top]:ms-5 text-xl" aria-label=Brand data-astro-cid-qlfjksao>Akiのink</a><div class="flex gap-x-4 sm:gap-x-6" data-astro-cid-qlfjksao><div class="transition-all duration-300 dark:group-[.expanded.not-top]:bg-primary-foreground end-0 grid group-[.expanded]:opacity-100 group-[.not-top]:rounded-xl max-md:border-b max-sm:absolute max-sm:group-[.expanded]:bg-background max-sm:group-[.not-top]:border max-sm:group-[.not-top]:pb-2 max-sm:group-[.not-top]:pt-2 max-sm:group-[.not-top]:px-4 max-sm:opacity-0 max-sm:pb-4 max-sm:pt-0 sm:border-0 sm:grid-rows-1 start-0 top-12 z-20" data-astro-cid-qlfjksao id=headerExpandConetent><div class="hidden -left-4 -z-10 absolute box-content dark:max-sm:group-[.expanded]:bg-primary-foreground max-sm:group-[.expanded.not-top]:hidden max-sm:group-[.expanded]:block w-[calc(100%+2rem)] bg-white h-full max-md:border-b top-0" data-astro-cid-qlfjksao></div><div class="flex items-center flex-col sm:flex-row gap-x-5 gap-y-2 justify-center overflow-hidden sm:gap-x-7 transition-colors" data-astro-cid-qlfjksao><a href=/blog class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>Blog </a><a href=/projects class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>Projects </a><a href=/links class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>Links </a><a href=/about class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>About</a><div class="flex flex-row gap-x-3 grow justify-end sm:gap-x-5 sm:w-fit w-full" data-astro-cid-qlfjksao><a href=https://www.travellings.cn/go.html class="px-1 py-2" data-astro-cid-qlfjksao title=Travelling><span class=sr-only data-astro-cid-qlfjksao>Travelling</span> <svg class=size-5 data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-train-2-line data-astro-cid-qlfjksao></use></svg> </a><a href=/search class="px-1 py-2" data-astro-cid-qlfjksao title=Search><span class=sr-only data-astro-cid-qlfjksao>Search</span> <svg class=size-5 data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-search-2-line data-astro-cid-qlfjksao></use></svg></a></div></div></div><div class="transition-all gap-x-4 flex group-[.not-top]:gap-x-2 group-[.not-top]:me-1.5" data-astro-cid-qlfjksao><button class="transition-all border hover:bg-border p-1.5 rounded-md sm:group-[.not-top]:rounded-xl group/dark" id=toggleDarkMode data-astro-cid-qlfjksao><span class=sr-only data-astro-cid-qlfjksao>Dark Theme</span> <svg class="transition-all group-hover/dark:text-primary size-5 dark:hidden" data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-sun-line data-astro-cid-qlfjksao></use></svg> <svg class="transition-all group-hover/dark:text-primary size-5 dark:block hidden" data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-moon-stars-line data-astro-cid-qlfjksao></use></svg></button> <button class="transition-all border hover:bg-border p-1.5 rounded-md sm:group-[.not-top]:rounded-xl sm:hidden" id=toggleMenu data-astro-cid-qlfjksao><span class=sr-only data-astro-cid-qlfjksao>Menu</span> <svg class=size-5 data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-menu-line data-astro-cid-qlfjksao></use></svg></button></div></div></nav></header></header-component><div class=w-full data-astro-cid-bvzihdzo style="--primaryColor:hsl(var(--primary) / var(--tw-text-opacity))"><a href=/blog class="transition-all py-1 border group bg-primary-foreground border-border gap-x-1 hover:bg-input inline-flex items-center no-underline px-2 rounded-lg text-muted-foreground text-sm" data-astro-cid-bvzihdzo data-astro-prefetch><svg class="group-hover:stroke-primary stroke-muted-foreground" fill=none height=16 stroke-linecap=round stroke-linejoin=round stroke-width=2.5 viewBox="0 0 24 24" width=16 xmlns=http://www.w3.org/2000/svg><line class="transition-all duration-300 ease-in-out group-hover:scale-x-100 scale-x-0 group-hover:translate-x-0 translate-x-3" x1=19 x2=5 y1=12 y2=12></line><polyline class="transition-all duration-300 ease-in-out group-hover:translate-x-0 translate-x-1" points="12 19 5 12 12 5"></polyline></svg><p class=my-0>Back</p></a><div class="gap-x-10 lg:flex lg:items-start mt-8" data-astro-cid-bvzihdzo style="--primaryColor:hsl(var(--primary) / var(--tw-text-opacity))"><aside class="animate -me-24 basis-60 max-lg:hidden order-2 sticky top-[15%]"><toc-heading><h2 class=font-semibold>TABLE OF CONTENTS</h2><ul class="max-h-[70vh] mt-4 overflow-y-scroll text-card-foreground"><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#四处理器体系结构 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75" aria-label="Scroll to section: 四、处理器体系结构">四、处理器体系结构</a></div><ul><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#41-y86-64指令集体系结构 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.1 Y86-64指令集体系结构">4.1 Y86-64指令集体系结构</a></div><ul><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#411-程序员可见的状态 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.1.1 程序员可见的状态">4.1.1 程序员可见的状态</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#412-y86-64指令 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.1.2 Y86-64指令">4.1.2 Y86-64指令</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#413指令编码 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.1.3指令编码">4.1.3指令编码</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#旁注--risc和cisc class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 旁注  RISC和CISC">旁注 RISC和CISC</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#414--y86-64异常 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.1.4  Y86-64异常">4.1.4 Y86-64异常</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#415-y86-64程序 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.1.5 Y86-64程序">4.1.5 Y86-64程序</a></div></li></ul></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#42-逻辑设计和硬件控制语言hcl class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.2 逻辑设计和硬件控制语言HCL">4.2 逻辑设计和硬件控制语言HCL</a></div><ul><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#逻辑门 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 逻辑门">逻辑门</a></div><ul><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#43--y86-64程序的实现 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.3  Y86-64程序的实现">4.3 Y86-64程序的实现</a></div><ul><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#431将处理组织成阶段 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.3.1  将处理组织成阶段">4.3.1  将处理组织成阶段</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#432--seq硬件结构 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.3.2  SEQ硬件结构">4.3.2 SEQ硬件结构</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#433-seq的时序 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.3.3 SEQ的时序">4.3.3 SEQ的时序</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#434-seq阶段的实现 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.3.4 SEQ阶段的实现">4.3.4 SEQ阶段的实现</a></div></li></ul></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#44-流水线的通用原理 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.4 流水线的通用原理">4.4 流水线的通用原理</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#45-y86-64的流水线实现 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 4.5 Y86-64的流水线实现">4.5 Y86-64的流水线实现</a></div></li></ul></li></ul></li></ul></li></ul></toc-heading></aside><article class="break-words flex-grow" data-astro-cid-bvzihdzo data-pagefind-body style="flex-grow:3;flex-shrink:1;flex-basis:60%;--primaryColor:hsl(var(--primary) / var(--tw-text-opacity))"><div data-astro-cid-bvzihdzo style="--primaryColor:hsl(var(--primary) / var(--tw-text-opacity))" id=blog-hero><div class="relative animate hero-image max-lg:mx-auto mb-6 prose"><img alt=4-处理器体系结构 decoding=async height=1100 loading=eager src=/_astro/4.jgS8Kphi_27IeSB.webp width=1954 class="relative w-full cover-image h-auto object-contain rounded-2xl z-10" fetchpriority=high inferSize=true><img alt=4-处理器体系结构 decoding=async height=1100 loading=eager src=/_astro/4.jgS8Kphi_27IeSB.webp width=1954 class="duration-300 absolute blur-xl h-full mt-0 opacity-40 start-0 top-4 transition-opacity w-full z-0" fetchpriority=high inferSize=true id=blurImage></div><div class="animate max-lg:mx-auto article-info max-w-[65ch]"><div class="flex flex-wrap gap-x-4 gap-y-2 leading-6 text-muted-foreground text-xs"><div class="flex items-center gap-1"><svg class=size-5><use href=/icons/ui.svg#mingcute-calendar-2-line></use></svg> <samp class=text-muted-foreground><time datetime=2023-02-18T04:00:00.000Z>Feb 18, 2023</time></samp></div><div class="flex items-center gap-1"><svg class=size-5><use href=/icons/ui.svg#mingcute-time-line></use></svg> 15 min read</div><span class="flex items-center gap-1"><svg class=size-5><use href=/icons/project.svg#mingcute-earth-2-line></use></svg> 中文</span></div><h1 class="font-medium mt-4 sm:mb-2 sm:mt-6 sm:text-3xl text-2xl">4-处理器体系结构</h1><div class="flex items-center flex-row flex-wrap gap-x-1 mt-3 sm:mt-5"><svg class=size-5><use href=/icons/ui.svg#mingcute-tag-line></use></svg><div><a href=/tags/csapp class="before:content-['#'] hover:underline hover:underline-offset-4 inline-block" aria-label="View more blogs with the tag csapp" data-pagefind-filter=tag>csapp</a></div></div><div class="mt-3 italic"><blockquote class="text-muted-foreground text-sm"><q>对应 CSAPP 第四章节</q></blockquote><div class="text-muted-foreground text-sm mt-1"><span class=waline-pageview-count data-path=/blog/4-处理器体系结构></span> views | <span class=waline-comment-count data-path=/blog/4-处理器体系结构></span> comments</div></div></div><div class="sm:mt-6 mt-4 border-t max-lg:mx-auto sm:w-1/3 w-1/2"></div></div><div class="text-muted-foreground dark:prose-invert mt-8 prose prose-base prose-headings:before:-ms-4 prose-headings:before:absolute prose-headings:font-medium prose-headings:text-foreground prose-th:before:content-none prose-zinc animate max-lg:mx-auto" data-astro-cid-bvzihdzo style="--primaryColor:hsl(var(--primary) / var(--tw-text-opacity))" id=content><h1 id=ics><a href=https://aki-yzh.github.io/2023/02/18/1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8&#x26;%E7%9B%AE%E5%BD%95 target=_blank rel="nofollow, noopener, noreferrer">ICS</a></h1><hr><h2 id=四处理器体系结构>四、处理器体系结构</h2><h3 id=41-y86-64指令集体系结构>4.1 Y86-64指令集体系结构</h3><h4 id=411-程序员可见的状态>4.1.1 程序员可见的状态</h4><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 程序员：用汇编代码写程序的人或产生机器级代码的编译器</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 可见状态：每条指令都会读取或修改处理器状态的某些部分      <img alt="" decoding=async height=938 loading=lazy src=/_astro/20221119152952.CC8RiLOX_Z1nH4iC.webp width=2548>      <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 15个程序寄存器，每个程序寄存器存储一个64位的字（8字节），寄存器%rsp被出栈，入栈，调用和返回指令作为栈指针。3个1位的条件码ZF，OF，SF，程序计数器PC存放当前正在执行指令的地址</p><h4 id=412-y86-64指令>4.1.2 Y86-64指令</h4><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> movq指令被分成了4个不同的指令：irmovq，rrmovq，mrmovq，rmmovq，源可以是立即数（i），寄存器（r）或内存（m）。指令的第一个字符表示源的类型，第二个表示了目的的类型。同x86-64，我们不允许将内存直接传送到另一个内存，也不允许将立即数传送到内存。      <img alt="" decoding=async height=558 loading=lazy src=/_astro/20221119153309.dzJLdA9O_gHDW.webp width=938> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> halt 停止指令的执行</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> nop 空操作</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 4个整数操作指令addq，subq，andq，xorq</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 7个跳转指令（图中的jxx）jmp、jle、jl、je、jne、jge、jg分支条件和x86-64一致。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 6个条件传送指令（图中的cmovxx）：cmovle、cmovl、cmove、cmovne、cmovge和cmovg、格式与rrmovq一样，但是只有当条件码满足约束才会更新寄存器的值。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> call 将返回地址入栈，然后跳到目的地址。ret指令从这样的调用中返回。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> pushq和pullq实现了入栈和出栈。</p><h4 id=413指令编码>4.1.3指令编码</h4><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 每条指令需要1～10个字节不等，每条指令的第一个字节表示指令的类型，这些字节分为两个部分，每部分4位：高四位是代码部分，低四位是功能部分（fn）。代码值位0～0x8 <img alt="" decoding=async height=444 loading=lazy src=/_astro/20221119153404.CyuY3bm2_ZTPOKf.webp width=1548> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> rrmovq与条件传送有相同的指令代码，可以把它看作是无条件传送，功能代码都是0</p><p>寄存器标识符</p><p><img alt="" decoding=async height=1030 loading=lazy src=/_astro/20221119153049.Bd8egUGF_ZaCKtn.webp width=2004> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> rA和rB被称为寄存器指示符字节，指定标识符对应的寄存器。不需要寄存器的则将r设置为0xF。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 有些指令需要一个附加的8字节常数字，这个字能作为irmovq的立即数，rmmovq和mrmovq的地址指示符的偏移量，以及分支指令和调用指令的目的地址。（分支指令和调用指令的目的是一个绝对地址，而非相对寻址）</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 比如对 rmmovq %rsp，0x123456789abcd（%rdx）；先填充为8字节得00 01 23 45 67 89 ab cd在小断法反序成cd ab 89 67 45 23 01 00，连起来得指令的编码为40 42 cd ab 89 67 45 23 01 00.</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 字节编码有唯一的解释。</p><h4 id=旁注--risc和cisc>旁注 RISC和CISC</h4><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 二者主要区别在于CISC指令数量很多而RISC少，RISC代码固定为4字节，RISC没有条件码，RISC寻址简单，RISC只有load和store允许内存调用，RISC细节可见。RISC指令延迟短，RISC比较简单，故代码长度一般更长</p><h4 id=414--y86-64异常>4.1.4 Y86-64异常</h4><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 状态码Stat描述程序运行的总体状态。 <img alt="" decoding=async height=292 loading=lazy src=/_astro/20221119153452.DFLCaw9C_THWa3.webp width=1008></p><h4 id=415-y86-64程序>4.1.5 Y86-64程序</h4><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 与x86-64的汇编代码相比，Y86-64需要将常数加载到寄存器。从内存中读取数值并与一个寄存器相加时，Y86-64需要两条指令，x86-64只需要一条。</p><h3 id=42-逻辑设计和硬件控制语言hcl>4.2 逻辑设计和硬件控制语言HCL</h3><h6 id=逻辑门>逻辑门</h6><p><img alt="" decoding=async height=224 loading=lazy src=/_astro/20221119153513.BvwNAtXJ_Z11aLS8.webp width=876> 组合电路要求： <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 1）每个逻辑门的输入必须连接到系统输入或者存储器输出或逻辑门输出上 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 2） 逻辑门的输出不能连在一起 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 3）网必须是无环的</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=c style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>HCL：</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>数据类型：</span><span style=color:#d73a49;--shiki-dark:#F97583>bool</span><span style=color:#24292e;--shiki-dark:#E1E4E8>, </span><span style=color:#d73a49;--shiki-dark:#F97583>int</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>操作</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>简单的布尔表达式:    </span><span style=color:#d73a49;--shiki-dark:#F97583>bool</span><span style=color:#24292e;--shiki-dark:#E1E4E8> out </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (s</span><span style=color:#d73a49;--shiki-dark:#F97583>&#x26;&#x26;</span><span style=color:#24292e;--shiki-dark:#E1E4E8>a)</span><span style=color:#d73a49;--shiki-dark:#F97583>||</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>!</span><span style=color:#24292e;--shiki-dark:#E1E4E8>s</span><span style=color:#d73a49;--shiki-dark:#F97583>&#x26;&#x26;</span><span style=color:#24292e;--shiki-dark:#E1E4E8>b)</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>情况表达式（多选器） word out </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> [select1 : expr1, select2 : expr2 ... ]</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>集合关系 </span><span style=color:#d73a49;--shiki-dark:#F97583>bool</span><span style=color:#24292e;--shiki-dark:#E1E4E8> s </span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8> code in { item1, item2, ... }</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>与C语言逻辑运算的区别</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>组合电路输出持续响应输入的变化</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>HCL无C语言中的“短路”，不会部分求值</span></span>
<span class=line></span></code></pre><p>存储器 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 分为时钟存储器和随机访问存储器</p><h5 id=43--y86-64程序的实现>4.3 Y86-64程序的实现</h5><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 描述一个SEQ的处理器</p><h6 id=431将处理组织成阶段>4.3.1  将处理组织成阶段</h6><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 1.取指（fetch）：从内存读取指令字节，地址为PC的值。从指令中抽取出指令指示符字节的两个四位部分，icode（指令代码）和ifun（指令功能）。可能取出一个寄存器指示符字节，指明一个或两个寄存器操作数指示符rA和rB。还可能取出个8字节常数字valC，计算出下一条指令地址valP。即valP等于PC+已执行操作的字节</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 2.译码（decode）：从寄存器文件读入最多两个操作数，得到valA和/或valB</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 3.执行（execute）ALU进行指令指明的操作或对栈指针进行增减，同时可能设置条件码</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 4.访存（memory） 将数据写入内存或读出数据</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 5.写回（write back）将结果写回寄存器文件</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 6.更新PC（PCupdate）将PC设置成下一条指令的地址</p><p>例： <img alt="" decoding=async height=730 loading=lazy src=/_astro/20221119153959.CYzIf_8M_Z1xwFwJ.webp width=1390> <img alt="" decoding=async height=610 loading=lazy src=/_astro/20221119155842.D4Qx_mtr_1ETK3e.webp width=950> <img alt="" decoding=async height=574 loading=lazy src=/_astro/20221119155911.-j0zGUyP_Z1yW6aM.webp width=944> <img alt="" decoding=async height=510 loading=lazy src=/_astro/20221119155923.DINu6Yn4_1hYXnS.webp width=952> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 其中PC 、rA、rB、OP等在运算中都是具体的值。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 整数操作指令遵循上面列出的通用模式。</p><p>如 <img alt="" decoding=async height=644 loading=lazy src=/_astro/20221119155946.Ch8JcylY_ItKjU.webp width=950> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 其他的操作同理。</p><h6 id=432--seq硬件结构>4.3.2 SEQ硬件结构</h6><img alt="" decoding=async height=1092 loading=lazy src=/_astro/20221119160543.CHURc486_ZHvTuh.webp width=624><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 取指：将程序计数器寄存器作为地址</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 译码：寄存器文件有两个读端口A和B，从这两个端口分别读取寄存器值valA和valB</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 执行：ALU执行，CC为条件码寄存器</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 访存：访问内存，进行写入或者读</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 写回：寄存器文件有两个写端口，E用来写入ALU计算出的值，M用来写从数据内存中读出来的值</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> PC更新：valP：下一条指令的地址；valC：调用指令或跳转指令制定的目标地址；valM：从内存读取的返回地址</p><h6 id=433-seq的时序>4.3.3 SEQ的时序</h6><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 原则：从不回读（处理器从来不需要为了完成一条指令的执行而去读由该指令更新了的状态） 例：没有指令既设置又读取条件码</p><h6 id=434-seq阶段的实现>4.3.4 SEQ阶段的实现</h6><p><img alt="" decoding=async height=926 loading=lazy src=/_astro/20221119160132.D8ktxxSn_pxRM6.webp width=986> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 1.取指阶段：以PC作为字节0的地址，一次从内存读出10个字节。第一个字节被解释成指令字节，然后icode和ifun的控制逻辑块计算指令和功能码。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> instr_valid：指令非法</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> need_regids:包含寄存器指示符字节</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=hcl style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>bool</span><span style=color:#005cc5;--shiki-dark:#79B8FF> need_regids</span><span style=color:#24292e;--shiki-dark:#E1E4E8>={</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>    icode</span><span style=color:#005cc5;--shiki-dark:#79B8FF> in</span><span style=color:#24292e;--shiki-dark:#E1E4E8>{IRRMOVLQ,IOPQ,IPUSHQ,IPOPQ,</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>        IIRMOVQ,IRMMOVQ,IMRMOVQ};</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>}</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> need_valC:包含常数字节</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 剩下9个字节是寄存器指示符字节和常数字节的组合编码。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 若need_regids为1，则字节1被分开装入rA和rB中，否则设为0xFF</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 产生常数valC根据need_regids的值由2～9或者1～8产生 <img alt="" decoding=async height=632 loading=lazy src=/_astro/20221119160213.ClC67x7H_ZtFHun.webp width=798> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> PC值为p+1+r+8i（r为need_regids的值，i为need_valC的值，p为初始PC）</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 2.译码和写回阶段：从寄存器文件中读取数据，寄存器文件有四个端口，读端口的地址输入为srcA和srcB，写端口的地址输入为dstE和dstM。读出的数值通过valA和valB输出，写入的数值通过valM和valE</p><img alt="" decoding=async height=468 loading=lazy src=/_astro/20221119160237.BHlLhTVZ_27X31Q.webp width=636><pre class="astro-code astro-code-themes github-dark github-light" data-language=hcl style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>word</span><span style=color:#005cc5;--shiki-dark:#79B8FF> srcA</span><span style=color:#24292e;--shiki-dark:#E1E4E8>={</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>    icode</span><span style=color:#005cc5;--shiki-dark:#79B8FF> in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> {IRRMOVQ,IRMMOVQ,IOPQ,IPUSHQ}</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>rA;</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>    icode</span><span style=color:#005cc5;--shiki-dark:#79B8FF> in</span><span style=color:#24292e;--shiki-dark:#E1E4E8>{IPOPQ,IRET}</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>RRSP;</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>    1</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>RNONE;</span><span style=color:#6a737d;--shiki-dark:#6A737D>#Don't need register</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>}</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>#warning :conditional move not implemented correctly here</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>word</span><span style=color:#005cc5;--shiki-dark:#79B8FF> destE</span><span style=color:#24292e;--shiki-dark:#E1E4E8>={</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>    icode</span><span style=color:#005cc5;--shiki-dark:#79B8FF> in</span><span style=color:#24292e;--shiki-dark:#E1E4E8>{IRRMOVQ}</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>rB;</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>    icode</span><span style=color:#005cc5;--shiki-dark:#79B8FF> in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> {IIRMOVQ,IOPQ}</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>rB;</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>    icode</span><span style=color:#005cc5;--shiki-dark:#79B8FF> in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> { IPUSHQ,IPOPQ,ICALL,IRET}</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>RRSP;</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>    1</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>RNONE;</span><span style=color:#6a737d;--shiki-dark:#6A737D>#Don't need register</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>}</span></span>
<span class=line></span></code></pre><p>3.执行阶段：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 对输入的aluA和aluB进行算数与逻辑运算 <img alt="" decoding=async height=420 loading=lazy src=/_astro/20221119160348.B-2G3JZ7_2nTSS.webp width=570></p><pre class="astro-code astro-code-themes github-dark github-light" data-language=hcl style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>word</span><span style=color:#005cc5;--shiki-dark:#79B8FF> aluA</span><span style=color:#24292e;--shiki-dark:#E1E4E8>={</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>    icode</span><span style=color:#005cc5;--shiki-dark:#79B8FF> in</span><span style=color:#24292e;--shiki-dark:#E1E4E8>{IRRMOVQ,IOPQ }</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>valA;</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>    icode</span><span style=color:#005cc5;--shiki-dark:#79B8FF> in</span><span style=color:#24292e;--shiki-dark:#E1E4E8>{IIRMOVQ,IRMMOVQ,IMRMOVQ}</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>valC;</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>    icode</span><span style=color:#005cc5;--shiki-dark:#79B8FF> in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> {ICALL,IPUShQ}</span><span style=color:#d73a49;--shiki-dark:#F97583>:-</span><span style=color:#005cc5;--shiki-dark:#79B8FF>8</span><span style=color:#24292e;--shiki-dark:#E1E4E8>;</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>    icode</span><span style=color:#005cc5;--shiki-dark:#79B8FF> in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> {IRET,IPOPQ}</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#005cc5;--shiki-dark:#79B8FF>8</span><span style=color:#24292e;--shiki-dark:#E1E4E8>;</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>    #other instructions don't need ALU</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>}</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>bool</span><span style=color:#005cc5;--shiki-dark:#79B8FF> set_cc</span><span style=color:#24292e;--shiki-dark:#E1E4E8> = </span><span style=color:#005cc5;--shiki-dark:#79B8FF>icode</span><span style=color:#005cc5;--shiki-dark:#79B8FF> in</span><span style=color:#24292e;--shiki-dark:#E1E4E8> {IOPQ};</span><span style=color:#6a737d;--shiki-dark:#6A737D>//仅运算改变条件码寄存器</span></span>
<span class=line></span></code></pre><p>4.访存阶段</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 从内存读入或者把数据写入内存中</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 进行读时产生valM <img alt="" decoding=async height=510 loading=lazy src=/_astro/20221119160328.8v6wVqgA_1UKOQb.webp width=570></p><pre class="astro-code astro-code-themes github-dark github-light" data-language=hcl style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>word mem_addr</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    icode in {IRMMOVQ,IPUSHQ,ICALL,IMRMOVQ}</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>valE;</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    icode in{IPOPQ,IRET}</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>valA;</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>#Other instructions don't need address</span></span>
<span class=line></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>];</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>bool</span><span style=color:#24292e;--shiki-dark:#E1E4E8> mem_read</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    icode in{IMRMOVQ,IPOPQ,IRET};</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>]</span><span style=color:#6a737d;--shiki-dark:#6A737D>//只读数据</span></span>
<span class=line></span></code></pre><p>5.更新PC状态 <img alt="" decoding=async height=256 loading=lazy src=/_astro/20221119160424.CiQAUh_H_1juzJE.webp width=446> 新PC可能是valC，valM或valP</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 当正在执行call或者满足跳转条件即将跳转时，PC为valC，正在执行RET，valM，其他为当前PC加当前指令长度</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=hcl style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>word new_PC</span><span style=color:#d73a49;--shiki-dark:#F97583>=</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    icode </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#24292e;--shiki-dark:#E1E4E8> ICALL</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>valC;</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    icode </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#24292e;--shiki-dark:#E1E4E8> IJXX</span><span style=color:#d73a49;--shiki-dark:#F97583>&#x26;&#x26;</span><span style=color:#24292e;--shiki-dark:#E1E4E8>Cnd</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>valC;</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    icode </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#24292e;--shiki-dark:#E1E4E8> IRET</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>valM;</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>    #default </span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>    1</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>valP;</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>]</span></span>
<span class=line></span></code></pre><p>总结 <img alt="" decoding=async height=1146 loading=lazy src=/_astro/20221119160037.CrNYIan7_Z28vuvO.webp width=994></p><h5 id=44-流水线的通用原理>4.4 流水线的通用原理</h5><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 我们用每秒千兆条指令（GIPS），也就是每秒十亿条指令，为单位来描述吞吐量。延迟为吞吐量的倒数。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 吞吐量=1/（执行时间+延迟）</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 画出流程图进行分析</p><p>v指令的转移由时钟信号决定</p><h5 id=45-y86-64的流水线实现>4.5 Y86-64的流水线实现</h5><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 将更新PC放在一个时钟周期的开始时执行</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 实现方法：创建一个寄存器来保存指令在执行过程中产生的信号，标号为前面加个p：电路重定时</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 流水线寄存器：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> F：保存程序计数器的预测值</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> D：位于取指和译码之间，保存最新取出的指令的信息</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> E：位于译码和执行之间，保存关于最新译码的指令和从寄存器文件中读出的值的信息</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> M ：位于执行和访存之间，保存最新执行的指令的结果</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> W：位于访存和反馈路径之间 <img alt="" decoding=async height=1266 loading=lazy src=/_astro/20221119160847.DrSj6Uco_1WnGSE.webp width=2780> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 流水线冒险 <img alt="" decoding=async height=880 loading=lazy src=/_astro/20221119161037.BAaiR73d_22mrn0.webp width=1170></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 存在数据相关或者控制相关，会产生错误的结果</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 指令在译码阶段读取寄存器时， 寄存器的ID分别与执行阶段，访存阶段以及写回阶段的目的寄存器进行比较 ，若相等则存在数据相关。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 1.用暂停来避免数据冒险</p><p>         stalling； 让一条指令停止在译码阶段，直到产生它的源操作数的指令通过了写回阶段</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 方法：插入气泡（bubble）气泡会占据周期 <img alt="" decoding=async height=412 loading=lazy src=/_astro/20221119161100.KH2Usxy__f5yVJ.webp width=1310> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 用暂停实现会严重降低流水线的吞吐量</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 2.用转发来避免数据冒险</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 转发在基本的硬件结构里添加了额外的数据链接与控制逻辑</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 增加逻辑块Sel+FwdA和FwdB <img alt="" decoding=async height=1304 loading=lazy src=/_astro/20221119161146.hlO3lLM6_Z1DhC0C.webp width=2748> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 不能单用转发解决的，暂停和转发结合使用</p><p>控制冒险：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 取指出现ret指令（暂停处理新指令直到ret到达写回阶段）</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 出现jxx指令：分支预测</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 假设总是进行跳转；若到达执行阶段发现预测错误则取消这些指令</p><p><strong>PIPE各阶段的实现</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 1.PC选择和取指阶段</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=hcl style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>word</span><span style=color:#005cc5;--shiki-dark:#79B8FF> f_pc</span><span style=color:#24292e;--shiki-dark:#E1E4E8>{</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    M_icode </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#24292e;--shiki-dark:#E1E4E8> IJXX </span><span style=color:#d73a49;--shiki-dark:#F97583>&#x26;&#x26;</span><span style=color:#d73a49;--shiki-dark:#F97583> !</span><span style=color:#24292e;--shiki-dark:#E1E4E8>M_Cnd</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>M_valA;</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    W_icode </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#24292e;--shiki-dark:#E1E4E8> IRET </span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>W_valM;</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>    1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>：F_predPC;</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>};</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>word f_predPC</span><span style=color:#d73a49;--shiki-dark:#F97583> =</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    f_icode in {IJXX,ICALL}</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>f_valC;</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>    1</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>f_valP;</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>];</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 2.译码和写回阶段</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=hcl style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>//译码阶段由于加入了转发变得复杂</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>word d_valA</span><span style=color:#d73a49;--shiki-dark:#F97583> =</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    D_icode in {ICALL,IJXX}</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>D_valP;</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    d_srcA </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#24292e;--shiki-dark:#E1E4E8> e_dstE </span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>e_valE ;</span><span style=color:#6a737d;--shiki-dark:#6A737D>//优先级执行优先</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    d_srcA </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#24292e;--shiki-dark:#E1E4E8> M_dstM </span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8> m_valM ;</span><span style=color:#6a737d;--shiki-dark:#6A737D>//访存次之</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    d_srcA </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#24292e;--shiki-dark:#E1E4E8> M_dstE </span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8> M_valE;</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    d_srcA </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#24292e;--shiki-dark:#E1E4E8> W_dstM </span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8> W_valM;</span><span style=color:#6a737d;--shiki-dark:#6A737D>//写回最次，先M后E</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>    d_secA </span><span style=color:#d73a49;--shiki-dark:#F97583>==</span><span style=color:#24292e;--shiki-dark:#E1E4E8> W_dstE </span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>W_valE;</span></span>
<span class=line><span style=color:#005cc5;--shiki-dark:#79B8FF>    1</span><span style=color:#d73a49;--shiki-dark:#F97583>:</span><span style=color:#24292e;--shiki-dark:#E1E4E8>d_rvalA;</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>]</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 3.执行阶段</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 与SEQ差别不大</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 4.访存阶段</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 差别不大</p><p><strong>性能分析</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 一个阶段处理了<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>C</mi><mi>i</mi></msub></mrow><annotation encoding=application/x-tex>C_i</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3117em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mathnormal mtight">i</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>条指令和<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>C</mi><mi>b</mi></msub></mrow><annotation encoding=application/x-tex>C_b</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07153em>C</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.3361em><span style=top:-2.55em;margin-left:-.0715em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mathnormal mtight">b</span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span>个气泡</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> CPI = 1+Cb/Ci</p><p>估算：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 加载指令（mrmovq和popq）占执行指令的25%，20%会导致冒险1气泡</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 条件分支指令占20%，40%不选择分支，2气泡</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 返回指令占2% 3气泡</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> CPI=1+<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mo>∑</mo></mrow><annotation encoding=application/x-tex>\sum</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:1em;vertical-align:-.25em></span><span class="mop op-symbol small-op" style=position:relative;top:0>∑</span></span></span></span> 指令频率x条件频率x气泡数</p><hr></div></article></div><div class="text-muted-foreground dark:prose-invert mt-8 prose prose-base prose-headings:before:-ms-4 prose-headings:before:absolute prose-headings:font-medium prose-headings:text-foreground prose-th:before:content-none prose-zinc" data-astro-cid-bvzihdzo style="--primaryColor:hsl(var(--primary) / var(--tw-text-opacity))"><div class="flex flex-col gap-y-2 border px-3 py-2 relative rounded-xl sm:px-4 sm:py-3"><svg class="opacity-10 absolute end-4 size-20 top-4"><use href=/icons/copyright-sponsor.svg#mingcute-copyright-line></use></svg><div class="flex flex-col"><div class=text-foreground>4-处理器体系结构</div><div class=text-sm>https://astro-theme-pure.vercel.app/blog/4-处理器体系结构</div></div><div class="flex flex-row flex-wrap gap-x-5 gap-y-1 justify-start sm:gap-x-8"><div class="flex gap-x-2 sm:flex-col"><span class=text-foreground>Author</span> <span class="text-sm max-sm:place-self-center">Aki</span></div><div class="flex gap-x-2 sm:flex-col sm:min-w-16"><span class=text-foreground>Update date</span> <span class="text-sm max-sm:place-self-center">February 18, 2023</span></div><div class="flex gap-x-2 sm:flex-col"><span class=text-foreground>Copyright</span> <a href=https://creativecommons.org/licenses/by/4.0/ class="text-muted-foreground text-sm max-sm:place-self-center" target=_blank>CC BY-NC-SA 4.0</a></div></div><div class=relative><div class="flex flex-row gap-3"><button class="transition-colors group bg-primary-foreground hover:text-primary p-1 rounded-full sm:p-1.5 text-muted-foreground" id=copy-link><svg class=size-5><use href=/icons/copyright-sponsor.svg#mingcute-link-2-line></use></svg></button><button class="transition-colors group bg-primary-foreground hover:text-primary p-1 rounded-full sm:p-1.5 text-muted-foreground" id=get-qrcode><svg class=size-5><use href=/icons/copyright-sponsor.svg#mingcute-qrcode-2-line></use></svg></button><button class="transition-colors group bg-primary-foreground hover:text-primary p-1 rounded-full sm:p-1.5 text-muted-foreground" id=share-weibo><svg class=size-5><use href=/icons/copyright-sponsor.svg#mingcute-weibo-line></use></svg></button></div><div class="transition-all duration-300 ease-in-out *:my-0 -mt-2 absolute aria-expanded:max-h-[256px] aria-expanded:opacity-100 aria-expanded:translate-y-4 bg-primary-foreground border box-content max-h-0 opacity-0 overflow-hidden p-4 rounded-xl z-10" id=qrcode aria-expanded=false></div></div></div><div class="border-t-0 border mx-6 pb-1.5 pt-1 px-3 rounded-b-xl sm:mx-8 sm:px-4"><a href=/projects#sponsorship class="flex justify-between no-underline text-muted-foreground" target=_blank><div>Buy me a cup of coffee ☕.</div><svg class="size-5 m-1"><use href=/icons/copyright-sponsor.svg#mingcute-receive-money-line></use></svg></a></div><script type=module>import QRCode from"/scripts/qrcode.js";const link=window.location.href,copyLink=document.getElementById("copy-link");function loadqrcode(e){if(!e)throw new Error("qrcode container not found");""===e.innerHTML&&new QRCode(e,link)}copyLink?.addEventListener("click",(()=>{navigator.clipboard.writeText(link)}));const getQRCode=document.getElementById("get-qrcode"),qrcodeContainer=document.getElementById("qrcode");if(!qrcodeContainer)throw new Error("qrcode container not found");getQRCode?.addEventListener("click",(()=>{"true"===qrcodeContainer.ariaExpanded?qrcodeContainer.ariaExpanded="false":(loadqrcode(qrcodeContainer),qrcodeContainer.ariaExpanded="true")}));const shareWeibo=document.getElementById("share-weibo");shareWeibo?.addEventListener("click",(()=>{const e=`http://service.weibo.com/share/share.php?url=${link}&title=${document.title}&pic=https://cravatar.cn/avatar/1ffe42aa45a6b1444a786b1f32dfa8aa?s=400`;window.open(e,"_blank")}))</script><div class="mt-3 sm:mt-6 gap-2 grid grid-cols-1 sm:gap-4 sm:grid-cols-2"><a href=/blog/5-优化程序性能 class="duration-300 transition-colors border border-transparent flex gap-3 group hover:bg-primary-foreground items-center no-underline px-4 py-2 rounded-lg sm:py-4"><svg class="transition-colors group-hover:stroke-primary stroke-muted-foreground rotate-180" fill=none height=20 stroke-linecap=round stroke-linejoin=round stroke-width=2.5 viewBox="0 0 24 24" width=20 xmlns=http://www.w3.org/2000/svg><line class="transition-all duration-300 ease-in-out group-hover:translate-x-1 group-hover:scale-x-100 scale-x-0 translate-x-4" x1=5 x2=19 y1=12 y2=12></line><polyline class="transition-all duration-300 ease-in-out group-hover:translate-x-1 translate-x-0" points="12 5 19 12 12 19"></polyline></svg><div class="flex flex-col gap-0.5 grow max-w-[80%] sm:gap-1.5"><div class="text-muted-foreground text-sm font-normal uppercase">Prev</div><div class="transition-colors font-medium truncate whitespace-nowrap">5-优化程序性能</div></div></a><a href=/blog/3-程序的机器级表示 class="duration-300 transition-colors border border-transparent flex gap-3 group hover:bg-primary-foreground items-center no-underline px-4 py-2 rounded-lg sm:py-4 justify-end text-right"><div class="flex flex-col gap-0.5 grow max-w-[80%] sm:gap-1.5"><div class="text-muted-foreground text-sm font-normal uppercase">Next</div><div class="transition-colors font-medium truncate whitespace-nowrap">3-程序的机器级表示</div></div><svg class="transition-colors group-hover:stroke-primary stroke-muted-foreground" fill=none height=20 stroke-linecap=round stroke-linejoin=round stroke-width=2.5 viewBox="0 0 24 24" width=20 xmlns=http://www.w3.org/2000/svg><line class="transition-all duration-300 ease-in-out group-hover:translate-x-1 group-hover:scale-x-100 scale-x-0 translate-x-4" x1=5 x2=19 y1=12 y2=12></line><polyline class="transition-all duration-300 ease-in-out group-hover:translate-x-1 translate-x-0" points="12 5 19 12 12 19"></polyline></svg></a></div><comment-component data-astro-cid-ksttp56e><div class="mt-3 sm:mt-6 not-prose" id=waline data-astro-cid-ksttp56e>Comment seems to stuck. Try to refresh?✨</div></comment-component></div><button class="transition-all duration-300 bg-primary-foreground opacity-0 border-2 border-transparent bottom-8 data-[show=true]:opacity-100 data-[show=true]:translate-y-0 end-4 fixed flex group h-10 hover:border-border/75 items-center justify-center rounded-full sm:end-8 sm:h-12 sm:w-12 text-muted-foreground translate-y-28 w-10 z-90" id=to-top-btn aria-label="Back to Top" data-show=false><div class="flex items-center justify-center absolute bottom-0 end-0 group-[.ended]:opacity-0 group-hover:opacity-0 start-0 top-0 transition-opacity"><span class=text>10</span> <span class=text-xs>%</span></div><svg class="size-6 group-[.ended]:opacity-100 group-hover:opacity-100 opacity-0 transition-opacity"><use href=/icons/ui.svg#mingcute-up-line></use></svg></button><script>!function(){const e=document.getElementById("to-top-btn"),t=e.children[0].children[0],n=document.getElementById("blog-hero"),o=document.getElementById("content");e.addEventListener("click",(()=>{document.documentElement.scrollTo({behavior:"smooth",top:0})}));new IntersectionObserver((function(t){t.forEach((t=>{e.dataset.show=(!t.isIntersecting).toString()}))})).observe(n);{const n=o.scrollHeight,c=o.offsetTop,d=document.documentElement.clientHeight;document.addEventListener("scroll",(()=>{const o=function(){var e=document.documentElement.scrollTop||document.body.scrollTop;if(!(e<c))return Math.round((e-c)/(n-d)*100)}();void 0!==o&&(t.innerText=o.toString(),e.classList.toggle("ended",o>100))}))}}()</script></div><footer class="w-full mx-auto mt-24"><div class="border-t border-border pt-5"><div class="flex items-center flex-col sm:flex-row gap-y-3 sm:flex sm:gap-y-0 sm:items-center sm:justify-between"><div class="flex items-center flex-col sm:flex-row gap-2 sm:gap-x-4 text-sm"><p class="">© <samp>2024</samp> Aki. All rights reserved.</p></div><div class="flex items-center justify-between"><div class="flex items-center gap-x-4"><a href=https://github.com/Aki-yzh class="transition-all text-muted-foreground hover:text-muted-foreground/75 inline-block" aria-label=github><svg class=size-6><use href=/icons/social.svg#mingcute-github-line></use></svg> </a><a href=/rss.xml class="transition-all text-muted-foreground hover:text-muted-foreground/75 inline-block" aria-label=rss><svg class=size-6><use href=/icons/social.svg#mingcute-rss-2-line></use></svg></a></div></div></div></div></footer></main></body></html>