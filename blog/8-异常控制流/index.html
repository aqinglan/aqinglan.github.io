<!DOCTYPE html><html lang="zh-CN, en-US"><head><meta charset=utf-8><meta content="width=device-width,initial-scale=1,shrink-to-fit=no" name=viewport><meta content="IE=edge" http-equiv=X-UA-Compatible><title>8-异常控制流 • Akiのink</title><link href=/favicon/apple-touch-icon.png rel=apple-touch-icon sizes=180x180><link href=/favicon/favicon-32x32.png rel=icon type=image/png sizes=32x32><link href=/favicon/favicon-16x16.png rel=icon type=image/png sizes=16x16><link href=/favicon/site.webmanifest rel=manifest><link href=/fonts/Satoshi-Variable.ttf rel=preload type=font/ttf as=font crossorigin><link href=/fonts/Satoshi-VariableItalic.ttf rel=preload type=font/ttf as=font crossorigin><link href=https://astro-theme-pure.vercel.app/blog/8-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81 rel=canonical><meta content="8-异常控制流 • Akiのink" name=title><meta content="对应 CSAPP 第八章节" name=description><meta content=Aki name=author><meta content="" name=theme-color><meta content=article property=og:type><meta content=8-异常控制流 property=og:title><meta content="对应 CSAPP 第八章节" property=og:description><meta content=https://astro-theme-pure.vercel.app/blog/8-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81 property=og:url><meta content=Akiのink property=og:site_name><meta content=en_US property=og:locale><meta content=https://astro-theme-pure.vercel.app/_astro/8.BkNqdoYB.png property=og:image><meta content=1200 property=og:image:width><meta content=630 property=og:image:height><meta content=Aki property=article:author><meta content=2023-02-18T08:00:00.000Z property=article:published_time><meta content=summary_large_image property=twitter:card><meta content=https://astro-theme-pure.vercel.app/blog/8-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81 property=twitter:url><meta content=8-异常控制流 property=twitter:title><meta content="对应 CSAPP 第八章节" property=twitter:description><meta content=https://astro-theme-pure.vercel.app/_astro/8.BkNqdoYB.png property=twitter:image><meta content=@cworld0_cn name=telegram:channel><link href=/sitemap-index.xml rel=sitemap><link href=https://astro-theme-pure.vercel.app/rss.xml rel=alternate type=application/rss+xml title=Akiのink><meta content="Astro v4.16.10" name=generator><link href=/styles/global.css rel=stylesheet><vercel-speed-insights data-params={&#34;slug&#34;:&#34;8-异常控制流&#34;} data-pathname=/blog/8-%E5%BC%82%E5%B8%B8%E6%8E%A7%E5%88%B6%E6%B5%81 data-props={}></vercel-speed-insights><script>console.log("%c Astro Theme Pure %c https://github.com/cworld1/astro-theme-pure/","color:#fff;background:linear-gradient(90deg,#448bff,#44e9ff);padding:5px 0;","color:#000;background:linear-gradient(90deg,#44e9ff,#ffffff);padding:5px 10px 5px 0px;")</script><link href=/_astro/_slug_.XaQ6XQsx.css rel=stylesheet><link href=/_astro/_slug_.BLJzc6jn.css rel=stylesheet><style>#waline[data-astro-cid-ksttp56e]{--waline-font-size:16px;--waline-white:hsl(var(--background) / var(--tw-bg-opacity));--waline-light-grey:#999;--waline-dark-grey:#666;--waline-theme-color:hsl(var(--foreground) / var(--tw-text-opacity));--waline-active-color:hsl(var(--primary) / var(--tw-text-opacity));--waline-color:hsl(var(--muted-foreground) / var(--tw-text-opacity));--waline-bg-color:hsl(var(--primary-foreground) / var(--tw-bg-opacity));--waline-bg-color-light:hsl(var(--input) / var(--tw-bg-opacity));--waline-bg-color-hover:#f0f0f0;--waline-border-color:hsl(var(--border) / var(--tw-border-opacity));--waline-disable-bg-color:#f8f8f8;--waline-disable-color:#bbb;--waline-code-bg-color:#282c34;--waline-bq-color:#f0f0f0;--waline-avatar-size:3.25rem;--waline-m-avatar-size:calc(var(--waline-avatar-size) * 9 / 13);--waline-badge-color:#3498db;--waline-badge-font-size:.775em;--waline-info-bg-color:var(--waline-bg-color-light);--waline-info-color:var(--waline-color);--waline-info-font-size:.625em;--waline-border:1px solid var(--waline-border-color);--waline-avatar-radius:50%;--waline-box-shadow:none}#waline[data-astro-cid-ksttp56e] .wl-reaction-title{display:none!important}#waline[data-astro-cid-ksttp56e] .wl-reaction{overflow:visible}#waline[data-astro-cid-ksttp56e] blockquote{position:relative;border-inline-start:4px solid transparent!important}#waline[data-astro-cid-ksttp56e] blockquote:before{content:"";height:100%;width:4px;left:-4px;top:0;position:absolute;border:2px solid var(--waline-bq-color)!important;border-radius:9999px}</style><link href=/_astro/_slug_.C639AhNv.css rel=stylesheet><script type=module src=/_astro/hoisted.B8nntUZK.js></script><script type=module src=/_astro/page.V2R8AmkL.js></script><script>window.va=window.va||function(){(window.vaq=window.vaq||[]).push(arguments)};var script=document.createElement("script");script.defer=!0,script.src="/_vercel/insights/script.js";var head=document.querySelector("head");head.appendChild(script)</script></head><body class="flex bg-background justify-center"><script>const lightModePref=window.matchMedia("(prefers-color-scheme: light)");function getUserPref(){return localStorage.getItem("theme")||(lightModePref.matches?"light":"dark")}function setTheme(e,t=!1){if(!["light","dark"].includes(e))return void console.log(`Invalid theme value '${e}' received. Expected 'light' or 'dark'.`);t&&localStorage.setItem("theme",e),document.documentElement.classList.toggle("dark","dark"===e);const r="dark"===e?"#0B0B10":"#FCFCFD";document.querySelector('meta[name="theme-color"]')?.setAttribute("content",r)}setTheme(getUserPref()),document.addEventListener("astro:after-swap",(()=>setTheme(getUserPref()))),document.addEventListener("theme-change",(e=>{const t=e.detail.theme;localStorage.setItem("theme",t),setTheme(e.detail.theme,!0)})),lightModePref.addEventListener("change",(e=>{setTheme(e.matches?"light":"dark")}))</script><main class="flex items-center flex-col leading-relaxed lg:px-10 max-w-[60rem] min-h-screen pb-10 px-4 sm:px-7 text-[0.92rem] w-screen z-10"><header-component class="transition-all duration-300 border-transparent group [&#38;.not-top]:bg-background [&#38;.not-top]:border-border border box-content dark:[&#38;.not-top]:bg-primary-foreground mb-16 py-1 rounded-xl sm:rounded-2xl sticky top-4 w-full z-30" data-astro-cid-qlfjksao><header class="flex flex-wrap sm:flex-nowrap sm:justify-start text-sm" data-astro-cid-qlfjksao><nav aria-label=global class="flex items-center justify-between mx-auto relative sm:flex sm:items-center w-full" data-astro-cid-qlfjksao><div class="hidden -left-4 -z-10 absolute box-content dark:max-sm:group-[.expanded]:bg-primary-foreground max-sm:group-[.expanded.not-top]:hidden max-sm:group-[.expanded]:block w-[calc(100%+2rem)] !duration-0 -top-8 h-20 max-sm:group-[.expanded]:bg-white" data-astro-cid-qlfjksao></div><a href=/ class="transition-all duration-300 flex-none font-semibold group-[.not-top]:ms-3 sm:group-[.not-top]:ms-5 text-xl" aria-label=Brand data-astro-cid-qlfjksao>Akiのink</a><div class="flex gap-x-4 sm:gap-x-6" data-astro-cid-qlfjksao><div class="transition-all duration-300 dark:group-[.expanded.not-top]:bg-primary-foreground end-0 grid group-[.expanded]:opacity-100 group-[.not-top]:rounded-xl max-md:border-b max-sm:absolute max-sm:group-[.expanded]:bg-background max-sm:group-[.not-top]:border max-sm:group-[.not-top]:pb-2 max-sm:group-[.not-top]:pt-2 max-sm:group-[.not-top]:px-4 max-sm:opacity-0 max-sm:pb-4 max-sm:pt-0 sm:border-0 sm:grid-rows-1 start-0 top-12 z-20" data-astro-cid-qlfjksao id=headerExpandConetent><div class="hidden -left-4 -z-10 absolute box-content dark:max-sm:group-[.expanded]:bg-primary-foreground max-sm:group-[.expanded.not-top]:hidden max-sm:group-[.expanded]:block w-[calc(100%+2rem)] bg-white h-full max-md:border-b top-0" data-astro-cid-qlfjksao></div><div class="flex items-center flex-col sm:flex-row gap-x-5 gap-y-2 justify-center overflow-hidden sm:gap-x-7 transition-colors" data-astro-cid-qlfjksao><a href=/blog class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>Blog </a><a href=/projects class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>Projects </a><a href=/links class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>Links </a><a href=/about class="w-full grow sm:w-fit flex-none font-medium hover:text-primary py-2 text-[1.05rem] text-right" aria-label="Nav Menu Item" data-astro-cid-qlfjksao>About</a><div class="flex flex-row gap-x-3 grow justify-end sm:gap-x-5 sm:w-fit w-full" data-astro-cid-qlfjksao><a href=https://www.travellings.cn/go.html class="px-1 py-2" data-astro-cid-qlfjksao title=Travelling><span class=sr-only data-astro-cid-qlfjksao>Travelling</span> <svg class=size-5 data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-train-2-line data-astro-cid-qlfjksao></use></svg> </a><a href=/search class="px-1 py-2" data-astro-cid-qlfjksao title=Search><span class=sr-only data-astro-cid-qlfjksao>Search</span> <svg class=size-5 data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-search-2-line data-astro-cid-qlfjksao></use></svg></a></div></div></div><div class="flex gap-x-4 group-[.not-top]:gap-x-2 group-[.not-top]:me-1.5 transition-all" data-astro-cid-qlfjksao><button class="transition-all border hover:bg-border p-1.5 rounded-md sm:group-[.not-top]:rounded-xl group/dark" id=toggleDarkMode data-astro-cid-qlfjksao><span class=sr-only data-astro-cid-qlfjksao>Dark Theme</span> <svg class="transition-all group-hover/dark:text-primary size-5 dark:hidden" data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-sun-line data-astro-cid-qlfjksao></use></svg> <svg class="transition-all group-hover/dark:text-primary size-5 dark:block hidden" data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-moon-stars-line data-astro-cid-qlfjksao></use></svg></button> <button class="transition-all border hover:bg-border p-1.5 rounded-md sm:group-[.not-top]:rounded-xl sm:hidden" id=toggleMenu data-astro-cid-qlfjksao><span class=sr-only data-astro-cid-qlfjksao>Menu</span> <svg class=size-5 data-astro-cid-qlfjksao><use href=/icons/header.svg#mingcute-menu-line data-astro-cid-qlfjksao></use></svg></button></div></div></nav></header></header-component><div class=w-full data-astro-cid-bvzihdzo style="--primaryColor:hsl(var(--primary) / var(--tw-text-opacity))"><a href=/blog class="transition-all py-1 border group bg-primary-foreground border-border gap-x-1 hover:bg-input inline-flex items-center no-underline px-2 rounded-lg text-muted-foreground text-sm" data-astro-cid-bvzihdzo data-astro-prefetch><svg class="group-hover:stroke-primary stroke-muted-foreground" fill=none height=16 stroke-linecap=round stroke-linejoin=round stroke-width=2.5 viewBox="0 0 24 24" width=16 xmlns=http://www.w3.org/2000/svg><line class="transition-all duration-300 ease-in-out group-hover:scale-x-100 scale-x-0 group-hover:translate-x-0 translate-x-3" x1=19 x2=5 y1=12 y2=12></line><polyline class="transition-all duration-300 ease-in-out group-hover:translate-x-0 translate-x-1" points="12 19 5 12 12 5"></polyline></svg><p class=my-0>Back</p></a><div class="gap-x-10 lg:flex lg:items-start mt-8" data-astro-cid-bvzihdzo style="--primaryColor:hsl(var(--primary) / var(--tw-text-opacity))"><aside class="animate -me-24 basis-60 max-lg:hidden order-2 sticky top-[15%]"><toc-heading><h2 class=font-semibold>TABLE OF CONTENTS</h2><ul class="max-h-[70vh] mt-4 overflow-y-scroll text-card-foreground"><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#八异常控制流ecf class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75" aria-label="Scroll to section: 八、异常控制流（ECF）">八、异常控制流（ECF）</a></div><ul><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#81-异常 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 8.1 异常">8.1 异常</a></div><ul><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#82-进程 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 8.2 进程">8.2 进程</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#83-系统调用错误处理 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 8.3 系统调用错误处理">8.3 系统调用错误处理</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#84-进程控制 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 8.4 进程控制">8.4 进程控制</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#85-信号 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 8.5 信号">8.5 信号</a></div></li><li><div class=relative><span class="duration-300 absolute [&.highlight-bg]:bg-primary [&.readed]:bg-input rounded top-[5%] transition-colors w-[2px]"></span> <a href=#86-非本地跳转 class="transition-all py-1 [&#38;.highlight-bg-translucent]:bg-primary-foreground [&#38;.highlight]:font-medium [&#38;.highlight]:text-primary [&#38;.readed]:text-input flex-1 hover:text-foreground line-clamp-2 ms-2 px-3 text-foreground/75 ps-7" aria-label="Scroll to section: 8.6 非本地跳转">8.6 非本地跳转</a></div></li></ul></li></ul></li></ul></toc-heading></aside><article class="break-words flex-grow" data-astro-cid-bvzihdzo data-pagefind-body style="flex-grow:3;flex-shrink:1;flex-basis:60%;--primaryColor:hsl(var(--primary) / var(--tw-text-opacity))"><div data-astro-cid-bvzihdzo style="--primaryColor:hsl(var(--primary) / var(--tw-text-opacity))" id=blog-hero><div class="relative animate hero-image max-lg:mx-auto mb-6 prose"><img alt=8-异常控制流 decoding=async height=1088 loading=eager src=/_astro/8.BkNqdoYB_8mkD8.webp width=1954 class="relative w-full cover-image h-auto object-contain rounded-2xl z-10" fetchpriority=high inferSize=true><img alt=8-异常控制流 decoding=async height=1088 loading=eager src=/_astro/8.BkNqdoYB_8mkD8.webp width=1954 class="duration-300 absolute blur-xl h-full mt-0 opacity-40 start-0 top-4 transition-opacity w-full z-0" fetchpriority=high inferSize=true id=blurImage></div><div class="animate max-lg:mx-auto article-info max-w-[65ch]"><div class="flex flex-wrap gap-x-4 gap-y-2 leading-6 text-muted-foreground text-xs"><div class="flex items-center gap-1"><svg class=size-5><use href=/icons/ui.svg#mingcute-calendar-2-line></use></svg> <samp class=text-muted-foreground><time datetime=2023-02-18T08:00:00.000Z>Feb 18, 2023</time></samp></div><div class="flex items-center gap-1"><svg class=size-5><use href=/icons/ui.svg#mingcute-time-line></use></svg> 16 min read</div><span class="flex items-center gap-1"><svg class=size-5><use href=/icons/project.svg#mingcute-earth-2-line></use></svg> 中文</span></div><h1 class="font-medium mt-4 sm:mb-2 sm:mt-6 sm:text-3xl text-2xl">8-异常控制流</h1><div class="flex items-center flex-row flex-wrap gap-x-1 mt-3 sm:mt-5"><svg class=size-5><use href=/icons/ui.svg#mingcute-tag-line></use></svg><div><a href=/tags/csapp class="before:content-['#'] hover:underline hover:underline-offset-4 inline-block" aria-label="View more blogs with the tag csapp" data-pagefind-filter=tag>csapp </a>,</div><div><a href=/tags/中断异常 class="before:content-['#'] hover:underline hover:underline-offset-4 inline-block" aria-label="View more blogs with the tag 中断异常" data-pagefind-filter=tag>中断异常</a></div></div><div class="mt-3 italic"><blockquote class="text-muted-foreground text-sm"><q>对应 CSAPP 第八章节</q></blockquote><div class="text-muted-foreground text-sm mt-1"><span class=waline-pageview-count data-path=/blog/8-异常控制流></span> views | <span class=waline-comment-count data-path=/blog/8-异常控制流></span> comments</div></div></div><div class="sm:mt-6 mt-4 border-t max-lg:mx-auto sm:w-1/3 w-1/2"></div></div><div class="text-muted-foreground dark:prose-invert mt-8 prose prose-base prose-headings:before:-ms-4 prose-headings:before:absolute prose-headings:font-medium prose-headings:text-foreground prose-th:before:content-none prose-zinc animate max-lg:mx-auto" data-astro-cid-bvzihdzo style="--primaryColor:hsl(var(--primary) / var(--tw-text-opacity))" id=content><h1 id=ics><a href=https://aki-yzh.github.io/2023/02/18/1-%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E6%BC%AB%E6%B8%B8&#x26;%E7%9B%AE%E5%BD%95 target=_blank rel="nofollow, noopener, noreferrer">ICS</a></h1><hr><h2 id=八异常控制流ecf>八、异常控制流（ECF）</h2><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> ECF是操作系统用来实现I/O，进程和虚拟内存的基本机制。</p><h4 id=81-异常>8.1 异常</h4><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 异常就是控制流中的突变，用来响应处理器状态中的某种变化。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 当处理器状态发生一个重要的变化时，处理器正在执行某个当前指令 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>I</mi><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>r</mi></mrow></msub></mrow><annotation encoding=application/x-tex>I_{curr}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style=margin-right:.02778em>rr</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> .在处理器中，状态被编码为不同的位和信号。状态变化称为事件，事件可能和当前指令的执行直接相关。</p><img alt="" decoding=async height=666 loading=lazy src=/_astro/20230214154528.BPcrI894_1ATctS.webp width=898><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 在任何情况下，当处理器检测到有事件发生时，它就会通过一张叫做异常表的跳转表，进行一个间接过程调用（异常），到一个专门设计用来处理这类事件的操作系统子程序（异常处理程序）。当异常处理程序完成处理后，根据引起异常的事件的类型，会发生以下三种情况中的一种：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 1) 处理程序将控制返回给当前指令 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>I</mi><mrow><mi>c</mi><mi>u</mi><mi>r</mi><mi>r</mi></mrow></msub></mrow><annotation encoding=application/x-tex>I_{curr}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.1514em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mathnormal mtight">c</span><span class="mord mathnormal mtight">u</span><span class="mord mathnormal mtight" style=margin-right:.02778em>rr</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> ,即当事件发生时正在执行的指令。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 2) 处理程序将控制返回给 <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><msub><mi>I</mi><mrow><mi>n</mi><mi>e</mi><mi>x</mi><mi>t</mi></mrow></msub></mrow><annotation encoding=application/x-tex>I_{next}</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:.8333em;vertical-align:-.15em></span><span class=mord><span class="mord mathnormal" style=margin-right:.07847em>I</span><span class=msupsub><span class="vlist-t vlist-t2"><span class=vlist-r><span class=vlist style=height:.2806em><span style=top:-2.55em;margin-left:-.0785em;margin-right:.05em><span class=pstrut style=height:2.7em></span><span class="mtight reset-size6 size3 sizing"><span class="mord mtight"><span class="mord mathnormal mtight">n</span><span class="mord mathnormal mtight">e</span><span class="mord mathnormal mtight">x</span><span class="mord mathnormal mtight">t</span></span></span></span></span><span class=vlist-s>​</span></span><span class=vlist-r><span class=vlist style=height:.15em><span></span></span></span></span></span></span></span></span></span> ,如果没有异常将会执行的下一条指令</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 3) 处理程序终止被中断的程序</p><p><strong>异常的分类</strong> <img alt="" decoding=async height=238 loading=lazy src=/_astro/20230214155537.DxIcPAZX_5Ji5J.webp width=1162></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 1. 中断：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 中断是异步发生的，是来自处理器外部的I/O设备的信号的结果。</p><img alt="" decoding=async height=236 loading=lazy src=/_astro/20230214155452.BdUH2MK__ENeAj.webp width=740><p>造成以下异常的指令称为故障指令。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 2. 陷阱：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 陷阱是有意的异常，是执行一条指令的结果，是同步的，总是返回到下一条指令，陷阱最重要的用途是在用户程序和内核之间提供一个像过程一样的接口，叫做系统调用。</p><img alt="" decoding=async height=252 loading=lazy src=/_astro/20230214155811.DcCPX6S9_Znmdd0.webp width=724><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 3. 故障：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 故障由错误情况引起，它可能被故障处理程序修正。如果能被修正，则将控制返回到引起故障的指令，否则返回内核中的abort例程。</p><img alt="" decoding=async height=224 loading=lazy src=/_astro/20230214155859.4NbyMm3B_Z1nSxkt.webp width=810><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 4. 终止：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 终止是不可恢复的致命错误造成的结果，通常是一些硬件错误。</p><p><strong>Linux/x86-64 系统中的异常</strong></p><table><thead><tr><th>异常号</th><th>描述</th><th>异常类别</th></tr></thead><tbody><tr><td>0</td><td>除法错误（浮点异常）</td><td>故障</td></tr><tr><td>13</td><td>一般保护故障</td><td>故障</td></tr><tr><td>14</td><td>缺页</td><td>故障</td></tr><tr><td>18</td><td>机器检查</td><td>终止</td></tr><tr><td>32~255</td><td>操作系统定义的异常</td><td>中断或陷阱</td></tr></tbody></table><p><strong>Linux/x86-64 系统调用</strong> <img alt="" decoding=async height=860 loading=lazy src=/_astro/20230214161004.Bt9hRkQM_Z1o4x0w.webp width=3232></p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>//用write写helloword</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> main</span><span style=color:#24292e;--shiki-dark:#E1E4E8>()</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>{</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>    write</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>1</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#032f62;--shiki-dark:#9ECBFF>"hello,world</span><span style=color:#005cc5;--shiki-dark:#79B8FF>\n</span><span style=color:#032f62;--shiki-dark:#9ECBFF>"</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>13</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span></span>
<span class=line><span style=color:#6f42c1;--shiki-dark:#B392F0>    _exit</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>0</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span></span>
<span class=line><span style=color:#24292e;--shiki-dark:#E1E4E8>}</span><span style=color:#6a737d;--shiki-dark:#6A737D>//第一个参数将输出发送到stdout，第二个参数是要写的字节序列，第三个参数是要写的字节数。</span></span>
<span class=line></span></code></pre><h4 id=82-进程>8.2 进程</h4><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 进程的经典定义是一个执行中程序的实例。系统中的每个程序都在某个进程的上下文中。上下文是由程序正确运行所需的状态组成的，这个状态包括存放在内存中的程序的代码和数据，它的栈，通用目的寄存器的内容，程序计数器，环境变量以及打开文件描述符的集合。</p><p><strong>逻辑控制流</strong> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 进程是轮流使用处理器的，每个进程执行它的流的一部分，然后被抢占（暂时挂起），然后轮到其他进程。</p><p><strong>并发流</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 一个逻辑流的执行在时间上与另一个流重叠</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 并发流的进程实际上仍是交错的，处理器不会同时处理两个进程</p><p><strong>私有地址空间</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 这个空间中某个地址关联的内存不能被其他进程读写</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 每个私有地址空间都有相同的通用结构</p><p><strong>用户模式与内核模式</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 设置了模式位就运行在内核模式中，否则运行在用户模式中。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 内核模式可以执行任何指令，访问系统的任何位置。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 进程从用户模式变为内核模式的唯一方法是通过异常，处理程序运行在内核模式中，当它返回到<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 应用程序代码时，处理器改回到用户模式</p><p><strong>上下文切换（控制转移）</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 保存当前进程的上下文->恢复某个先前被抢占的进程保存的上下文-> 将控制传递给新恢复的进程</p><img alt="" decoding=async height=318 loading=lazy src=/_astro/20230214162756.D7QHh79F_Z2mdJ94.webp width=862><h4 id=83-系统调用错误处理>8.3 系统调用错误处理</h4><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 默认使用错误处理包装函数，使代码简洁</p><h4 id=84-进程控制>8.4 进程控制</h4><p><strong>获取进程id</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 每个进程都有一个唯一的正数进程ID（PID）</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>#include</span><span style=color:#032f62;--shiki-dark:#9ECBFF>&#x3C;sys/types.h></span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>#include</span><span style=color:#032f62;--shiki-dark:#9ECBFF>&#x3C;unistd.h></span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>pid_t</span><span style=color:#6f42c1;--shiki-dark:#B392F0> getpid</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>void</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span><span style=color:#6a737d;--shiki-dark:#6A737D>//返回调用进程的pid</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>pid_t</span><span style=color:#6f42c1;--shiki-dark:#B392F0> getppid</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>void</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span><span style=color:#6a737d;--shiki-dark:#6A737D>//返回父进程的pid</span></span>
<span class=line></span></code></pre><p><strong>创建和终止进程</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 进程总是处于以下三种状态之一：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 运行：要么在CPU上执行，要么在等待被执行且最终会被内核调度</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 停止： 进程的执行被挂起，且不会被调度。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 终止： 收到终止信号/从主程序返回/调用exit函数</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>void</span><span style=color:#6f42c1;--shiki-dark:#B392F0> exit</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#e36209;--shiki-dark:#FFAB70> status</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span><span style=color:#6a737d;--shiki-dark:#6A737D>//exit函数以status退出状态来终止进程。</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span>父进程通过调用fork函数创建一个新的运行的子进程</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>pid_t</span><span style=color:#6f42c1;--shiki-dark:#B392F0> fork</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>void</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 两个进程并发执行，地址空间相同但独立，共享打开的文件</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 调用一次，返回两次，父进程返回子进程的PID，子进程总是返回0。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 父进程和子进程之间最大的区别在于他们拥有不同的PID。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 返回值提供了一个明确的方法来分辨程序是在父进程还是在子进程中执行。</p><p>进程图</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 每个顶点是一条语句的执行</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> main是起始点</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 并发式程序的语句执行存在拓扑排序</p><img alt="" decoding=async height=202 loading=lazy src=/_astro/20230214164108.DwfdY2Oa_Z2vAKrv.webp width=568><p><strong>回收子进程</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 子进程终止后保持一个已终止的状态直到被父进程回收</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 父进程终止后内核会安排init(PID=1)为其所有孤儿进程的养父</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 一个进程可以通过调用waitpid函数来等待它的子进程终止或停止,成功返回子进程的pid，如果WNOHANG，返回0，否则返回-1.</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>pid_t</span><span style=color:#6f42c1;--shiki-dark:#B392F0> waitpid</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>pid_t</span><span style=color:#e36209;--shiki-dark:#FFAB70> pid</span><span style=color:#24292e;--shiki-dark:#E1E4E8> , </span><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#e36209;--shiki-dark:#FFAB70>statusp</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#e36209;--shiki-dark:#FFAB70> options</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> pid: 判定等待集合（>0，单一子进程；=-1，所有子进程）</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span>options：可修改的默认行为(WNOHANG：任何子进程都未终止返回0； WUNTRACED：<span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span>挂起调用进程的执行，直到等待集合中的一个进程变为已终止或被停止； WCONTINUED：挂起调用进程的执行，知道等待集合中的一个被停止的进程收到SIGCONT信号重新开始执行)（也可以用｜组合起来）</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> statusp：检查已回收子进程的退出状态</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> WIFEXITED：子进程通过调用exit或者return正常终止，true</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> WEXITSIATUS：返回一个正常终止子进程的退出状态</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> WIFSIGNALED： 如果子进程是因为一个未被捕获的信号终止的，那么就返回真</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> WTERMSIG：返回导致子进程终止的信号的编号</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> WIFSTOPPED： 如果引起返回的子进程当前是停止的，那么就返回真</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> WSTOPSIG：返回引起子进程停止的信号的编号</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> WIFCONTINUED：如果子进程收到SIGCONT信号重新启动，则返回真。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 错误条件：如果调用进程没有子进程，那么waitpid返回-1，并设置errno为ECHILD，如果waidpid函数被一个信号中断，返回-1，设置errno为EINTR。</p><p><strong>wait函数</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 等价于waitpid(-1,&#x26;status,0);</p><p><strong>让进程休眠</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> sleep函数将一个进程挂起一段指定的时间</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>unsigned</span><span style=color:#d73a49;--shiki-dark:#F97583> int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> sleep</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>unsigned</span><span style=color:#d73a49;--shiki-dark:#F97583> int</span><span style=color:#e36209;--shiki-dark:#FFAB70> secs</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 如果请求的时间量已经到了，返回0，否则返回还剩下要休眠的秒数</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> pause</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>void</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> pause函数让调用函数休眠直到该进程收到一个信号</p><p><strong>加载并运行程序</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> execve函数在当前进程的上下文中加载并运行一个新程序</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> execve</span><span style=color:#24292e;--shiki-dark:#E1E4E8> (</span><span style=color:#d73a49;--shiki-dark:#F97583>const</span><span style=color:#d73a49;--shiki-dark:#F97583> char</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#e36209;--shiki-dark:#FFAB70>filename</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#d73a49;--shiki-dark:#F97583>const</span><span style=color:#d73a49;--shiki-dark:#F97583> char</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#e36209;--shiki-dark:#FFAB70>argv</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[],</span><span style=color:#d73a49;--shiki-dark:#F97583>const</span><span style=color:#d73a49;--shiki-dark:#F97583> char</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#e36209;--shiki-dark:#FFAB70>envp</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[]);</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 加载并运行可执行目标文件filename，且带参数列表argv和环境变量列表envp。成功不返回，错误返回-1。</p><p><strong>shell：交互型应用级程序</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 命令行->parseline->builtincommand</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 最后一个参数：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> &#x26;->后台执行</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 其他->前台执行</p><h4 id=85-信号>8.5 信号</h4><img alt="" decoding=async height=1246 loading=lazy src=/_astro/20230214174524.DpcGO1cn_14qztl.webp width=1260><p><strong>发送信号</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 内核通过更新目的进程中上下文中的某个状态，发送一个信号给目的进程。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 原因：1.内核检测到一个系统事件，比如除0错误或子进程终止2.一个进程调用了kill函数，显式地要求内核发送一个信号给目的进程。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 一个进程可以发送信号给它自己。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 发送信号基于进程组，进程组由一个正整数进程组ID来标识。</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>pid_t</span><span style=color:#6f42c1;--shiki-dark:#B392F0> getpgrp</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>void</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span><span style=color:#6a737d;--shiki-dark:#6A737D>//返回当前进程的进程组ID</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 默认地，一个子进程和它的父进程同属于一个进程组，一个进程可以通过setpgid来改变自己或者其他进程的进程组。将进程pid的进程组改为pgid，如果pid是0，那么就使用当前进程的PID，如果pgid是0，那么就用pid指定的进程的PID作为进程组id。</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> setpgid</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>pid_t</span><span style=color:#e36209;--shiki-dark:#FFAB70> pid</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#d73a49;--shiki-dark:#F97583>pid_t</span><span style=color:#e36209;--shiki-dark:#FFAB70> pgid</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span><span style=color:#6a737d;--shiki-dark:#6A737D>//成功返回0，错误返回-1；</span></span>
<span class=line></span></code></pre><p>发送途径：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> <em>用/bin/kill程序发送信号</em>：/bin/kill -9 114514 ->发送信号9给进程114514，符号表示发给进程组中的每个进程。</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 从键盘发送信号</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 用kill函数发送信号 ,pid大于0，发送sig到pid；pid等于0，发送sig到调用进程所在进程组中的每个进程，pid小于0，发送sig到|pid|中的每个进程。</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> kill</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>pid_t</span><span style=color:#e36209;--shiki-dark:#FFAB70> pid</span><span style=color:#24292e;--shiki-dark:#E1E4E8> ,</span><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#e36209;--shiki-dark:#FFAB70> sig</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span><span style=color:#6a737d;--shiki-dark:#6A737D>//成功返回0，错误返回-1</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 用alarm函数发送信号：向自己发送SIGALRM信号</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>unsigned</span><span style=color:#d73a49;--shiki-dark:#F97583> int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> alarm</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>unsigned</span><span style=color:#d73a49;--shiki-dark:#F97583> int</span><span style=color:#e36209;--shiki-dark:#FFAB70> secs</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span><span style=color:#6a737d;--shiki-dark:#6A737D>//返回前一次闹钟剩余的秒数，若没设定，返回0</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span></p><p><strong>接收信号</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 目的进程被内核强迫对信号作出反应，进程p从内核模式切换到用户模式时，若待处理信号集合为空，控制传递到p的下一条指令；若非空，选择某个信号k，强制p接受k</p><img alt="" decoding=async height=504 loading=lazy src=/_astro/20230214193024.BSOnYE0k_Z212jCc.webp width=906><p><strong>待处理信号</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 发出但没有被接收的信号</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 任何时候一个类型至多有一个待处理信号（用pending位向量维护，传送时设置，接收时清除）</p><p><strong>阻塞/解除阻塞信号</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 隐式阻塞：默认阻塞当前正在处理信号的同类型信号</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 显式阻塞：sigprocmask函数和相关函数，明确地阻塞/解除阻塞指定的信号</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>#include</span><span style=color:#032f62;--shiki-dark:#9ECBFF>&#x3C;signal.h></span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> sigprocmask</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#e36209;--shiki-dark:#FFAB70> how</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#d73a49;--shiki-dark:#F97583>const</span><span style=color:#005cc5;--shiki-dark:#79B8FF> sigset_t</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#e36209;--shiki-dark:#FFAB70>set</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#005cc5;--shiki-dark:#79B8FF>sigset_t</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#e36209;--shiki-dark:#FFAB70>oldset</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> sigemptyset</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>sigset_t</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#e36209;--shiki-dark:#FFAB70>set</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> sigfillset</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>sigset_t</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#e36209;--shiki-dark:#FFAB70>set</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> sigaddset</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>sigset_t</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#e36209;--shiki-dark:#FFAB70>set</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#e36209;--shiki-dark:#FFAB70> signum</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> sigdelset</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#005cc5;--shiki-dark:#79B8FF>sigset_t</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#e36209;--shiki-dark:#FFAB70>set</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#e36209;--shiki-dark:#FFAB70> signum</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>/* 成功返回0，出错-1 */</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> sigismember</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>const</span><span style=color:#005cc5;--shiki-dark:#79B8FF> sigset_t</span><span style=color:#d73a49;--shiki-dark:#F97583> *</span><span style=color:#e36209;--shiki-dark:#FFAB70>set</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#e36209;--shiki-dark:#FFAB70> signum</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span></span>
<span class=line><span style=color:#6a737d;--shiki-dark:#6A737D>//signum是set成员返回1，不是则0，出错-1</span></span>
<span class=line></span></code></pre><p>how： <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> SIG_BLOCK：把set中的信号添加到blocked中</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> SIGUNBLOCK：从block中删除set中的信号</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> SIG_SETMASK：BLOCK=set</p><p><strong>编写信号处理程序</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 安全的信号处理：</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 处理程序尽可能简单</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 只调用异步信号安全的函数（可重入，不可被信号处理程序中断）</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> <span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> SIO包：安全打印简单信息</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>#include</span><span style=color:#032f62;--shiki-dark:#9ECBFF>&#x3C;csapp.h></span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>ssize_t</span><span style=color:#6f42c1;--shiki-dark:#B392F0> sio_putl</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>long</span><span style=color:#e36209;--shiki-dark:#FFAB70> v</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span><span style=color:#6a737d;--shiki-dark:#6A737D>//向标准输出传送long类型数</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>ssize_t</span><span style=color:#6f42c1;--shiki-dark:#B392F0> sio_puts</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#d73a49;--shiki-dark:#F97583>char</span><span style=color:#e36209;--shiki-dark:#FFAB70> s</span><span style=color:#24292e;--shiki-dark:#E1E4E8>[]);</span><span style=color:#6a737d;--shiki-dark:#6A737D>//向标准输出传送一个字符串</span></span>
<span class=line></span></code></pre><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 保存和恢复errno</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 阻塞所有信号，保护对共享全局数据结构的访问</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 用volatile声明全局变量->阻止编译器缓存变量</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 用sig_atomic_t声明标志</p><p><strong>同步流以避免并发错误</strong></p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 由于父进程和子进程并发进行，可能存在竞争，导致信号丢失</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=2em></mspace></mrow><annotation encoding=application/x-tex>\qquad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:2em></span></span></span></span> 解决：调用前阻塞信号</p><h4 id=86-非本地跳转>8.6 非本地跳转</h4><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 将控制直接从一个函数转移到另一个函数（无需调用返回）</p><p><span class=katex><span class=katex-mathml><math xmlns=http://www.w3.org/1998/Math/MathML><semantics><mrow><mspace width=1em></mspace></mrow><annotation encoding=application/x-tex>\quad</annotation></semantics></math></span><span class=katex-html aria-hidden=true><span class=base><span class=strut style=height:0></span><span class=mspace style=margin-right:1em></span></span></span></span> 通过setjmp和longjmp提供</p><pre class="astro-code astro-code-themes github-dark github-light" data-language=cpp style=background-color:#fff;--shiki-dark-bg:#24292e;color:#24292e;--shiki-dark:#e1e4e8;overflow-x:auto tabindex=0><code><span class=line><span style=color:#d73a49;--shiki-dark:#F97583>#include</span><span style=color:#032f62;--shiki-dark:#9ECBFF>&#x3C;setjmp.h></span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> setjmp</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#6f42c1;--shiki-dark:#B392F0>jmp_buf</span><span style=color:#e36209;--shiki-dark:#FFAB70> env</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span><span style=color:#6a737d;--shiki-dark:#6A737D>//在env缓冲区中保存当前调用环境</span></span>
<span class=line><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#6f42c1;--shiki-dark:#B392F0> sigsetjmp</span><span style=color:#24292e;--shiki-dark:#E1E4E8>(</span><span style=color:#6f42c1;--shiki-dark:#B392F0>sigjmp_buf</span><span style=color:#e36209;--shiki-dark:#FFAB70> env</span><span style=color:#24292e;--shiki-dark:#E1E4E8>,</span><span style=color:#d73a49;--shiki-dark:#F97583>int</span><span style=color:#e36209;--shiki-dark:#FFAB70> savesigs</span><span style=color:#24292e;--shiki-dark:#E1E4E8>);</span><span style=color:#6a737d;--shiki-dark:#6A737D>//从env缓冲区恢复调用环境，并触发最近一个setjmp的返回</span></span>
<span class=line></span></code></pre><hr></div></article></div><div class="text-muted-foreground dark:prose-invert mt-8 prose prose-base prose-headings:before:-ms-4 prose-headings:before:absolute prose-headings:font-medium prose-headings:text-foreground prose-th:before:content-none prose-zinc" data-astro-cid-bvzihdzo style="--primaryColor:hsl(var(--primary) / var(--tw-text-opacity))"><div class="flex flex-col gap-y-2 border px-3 py-2 relative rounded-xl sm:px-4 sm:py-3"><svg class="opacity-10 absolute end-4 size-20 top-4"><use href=/icons/copyright-sponsor.svg#mingcute-copyright-line></use></svg><div class="flex flex-col"><div class=text-foreground>8-异常控制流</div><div class=text-sm>https://astro-theme-pure.vercel.app/blog/8-异常控制流</div></div><div class="flex flex-row flex-wrap gap-x-5 gap-y-1 justify-start sm:gap-x-8"><div class="flex gap-x-2 sm:flex-col"><span class=text-foreground>Author</span> <span class="text-sm max-sm:place-self-center">Aki</span></div><div class="flex gap-x-2 sm:flex-col sm:min-w-16"><span class=text-foreground>Update date</span> <span class="text-sm max-sm:place-self-center">February 18, 2023</span></div><div class="flex gap-x-2 sm:flex-col"><span class=text-foreground>Copyright</span> <a href=https://creativecommons.org/licenses/by/4.0/ class="text-muted-foreground text-sm max-sm:place-self-center" target=_blank>CC BY-NC-SA 4.0</a></div></div><div class=relative><div class="flex flex-row gap-3"><button class="text-muted-foreground bg-primary-foreground group rounded-full hover:text-primary p-1 sm:p-1.5 transition-colors" id=copy-link><svg class=size-5><use href=/icons/copyright-sponsor.svg#mingcute-link-2-line></use></svg></button><button class="text-muted-foreground bg-primary-foreground group rounded-full hover:text-primary p-1 sm:p-1.5 transition-colors" id=get-qrcode><svg class=size-5><use href=/icons/copyright-sponsor.svg#mingcute-qrcode-2-line></use></svg></button><button class="text-muted-foreground bg-primary-foreground group rounded-full hover:text-primary p-1 sm:p-1.5 transition-colors" id=share-weibo><svg class=size-5><use href=/icons/copyright-sponsor.svg#mingcute-weibo-line></use></svg></button></div><div class="transition-all duration-300 ease-in-out *:my-0 -mt-2 absolute aria-expanded:max-h-[256px] aria-expanded:opacity-100 aria-expanded:translate-y-4 bg-primary-foreground border box-content max-h-0 opacity-0 overflow-hidden p-4 rounded-xl z-10" id=qrcode aria-expanded=false></div></div></div><div class="border-t-0 border mx-6 pb-1.5 pt-1 px-3 rounded-b-xl sm:mx-8 sm:px-4"><a href=/projects#sponsorship class="flex justify-between no-underline text-muted-foreground" target=_blank><div>Buy me a cup of coffee ☕.</div><svg class="size-5 m-1"><use href=/icons/copyright-sponsor.svg#mingcute-receive-money-line></use></svg></a></div><script type=module>import QRCode from"/scripts/qrcode.js";const link=window.location.href,copyLink=document.getElementById("copy-link");function loadqrcode(e){if(!e)throw new Error("qrcode container not found");""===e.innerHTML&&new QRCode(e,link)}copyLink?.addEventListener("click",(()=>{navigator.clipboard.writeText(link)}));const getQRCode=document.getElementById("get-qrcode"),qrcodeContainer=document.getElementById("qrcode");if(!qrcodeContainer)throw new Error("qrcode container not found");getQRCode?.addEventListener("click",(()=>{"true"===qrcodeContainer.ariaExpanded?qrcodeContainer.ariaExpanded="false":(loadqrcode(qrcodeContainer),qrcodeContainer.ariaExpanded="true")}));const shareWeibo=document.getElementById("share-weibo");shareWeibo?.addEventListener("click",(()=>{const e=`http://service.weibo.com/share/share.php?url=${link}&title=${document.title}&pic=https://cravatar.cn/avatar/1ffe42aa45a6b1444a786b1f32dfa8aa?s=400`;window.open(e,"_blank")}))</script><div class="mt-3 sm:mt-6 gap-2 grid grid-cols-1 sm:gap-4 sm:grid-cols-2"><a href=/blog/9-虚拟内存 class="flex items-center border-transparent duration-300 group border gap-3 hover:bg-primary-foreground no-underline px-4 py-2 rounded-lg sm:py-4 transition-colors"><svg class="transition-colors group-hover:stroke-primary stroke-muted-foreground rotate-180" fill=none height=20 stroke-linecap=round stroke-linejoin=round stroke-width=2.5 viewBox="0 0 24 24" width=20 xmlns=http://www.w3.org/2000/svg><line class="transition-all duration-300 ease-in-out group-hover:translate-x-1 group-hover:scale-x-100 scale-x-0 translate-x-4" x1=5 x2=19 y1=12 y2=12></line><polyline class="transition-all duration-300 ease-in-out group-hover:translate-x-1 translate-x-0" points="12 5 19 12 12 19"></polyline></svg><div class="flex flex-col gap-0.5 grow max-w-[80%] sm:gap-1.5"><div class="text-muted-foreground text-sm font-normal uppercase">Prev</div><div class="transition-colors font-medium truncate whitespace-nowrap">9-虚拟内存</div></div></a><a href=/blog/7-链接 class="flex items-center border-transparent duration-300 group border gap-3 hover:bg-primary-foreground no-underline px-4 py-2 rounded-lg sm:py-4 transition-colors justify-end text-right"><div class="flex flex-col gap-0.5 grow max-w-[80%] sm:gap-1.5"><div class="text-muted-foreground text-sm font-normal uppercase">Next</div><div class="transition-colors font-medium truncate whitespace-nowrap">7-链接</div></div><svg class="transition-colors group-hover:stroke-primary stroke-muted-foreground" fill=none height=20 stroke-linecap=round stroke-linejoin=round stroke-width=2.5 viewBox="0 0 24 24" width=20 xmlns=http://www.w3.org/2000/svg><line class="transition-all duration-300 ease-in-out group-hover:translate-x-1 group-hover:scale-x-100 scale-x-0 translate-x-4" x1=5 x2=19 y1=12 y2=12></line><polyline class="transition-all duration-300 ease-in-out group-hover:translate-x-1 translate-x-0" points="12 5 19 12 12 19"></polyline></svg></a></div><comment-component data-astro-cid-ksttp56e><div class="mt-3 sm:mt-6 not-prose" id=waline data-astro-cid-ksttp56e>Comment seems to stuck. Try to refresh?✨</div></comment-component></div><button class="flex items-center border-transparent duration-300 group bg-primary-foreground border-2 bottom-8 data-[show=true]:opacity-100 data-[show=true]:translate-y-0 end-4 fixed h-10 hover:border-border/75 justify-center opacity-0 rounded-full sm:end-8 sm:h-12 sm:w-12 text-muted-foreground transition-all translate-y-28 w-10 z-90" id=to-top-btn aria-label="Back to Top" data-show=false><div class="flex items-center justify-center absolute bottom-0 end-0 group-[.ended]:opacity-0 group-hover:opacity-0 start-0 top-0 transition-opacity"><span class=text>10</span> <span class=text-xs>%</span></div><svg class="size-6 group-[.ended]:opacity-100 group-hover:opacity-100 opacity-0 transition-opacity"><use href=/icons/ui.svg#mingcute-up-line></use></svg></button><script>!function(){const e=document.getElementById("to-top-btn"),t=e.children[0].children[0],n=document.getElementById("blog-hero"),o=document.getElementById("content");e.addEventListener("click",(()=>{document.documentElement.scrollTo({behavior:"smooth",top:0})}));new IntersectionObserver((function(t){t.forEach((t=>{e.dataset.show=(!t.isIntersecting).toString()}))})).observe(n);{const n=o.scrollHeight,c=o.offsetTop,d=document.documentElement.clientHeight;document.addEventListener("scroll",(()=>{const o=function(){var e=document.documentElement.scrollTop||document.body.scrollTop;if(!(e<c))return Math.round((e-c)/(n-d)*100)}();void 0!==o&&(t.innerText=o.toString(),e.classList.toggle("ended",o>100))}))}}()</script></div><footer class="w-full mx-auto mt-24"><div class="border-t border-border pt-5"><div class="flex items-center flex-col sm:flex-row gap-y-3 sm:flex sm:gap-y-0 sm:items-center sm:justify-between"><div class="flex items-center flex-col sm:flex-row gap-2 sm:gap-x-4 text-sm"><p class="">© <samp>2024</samp> Aki. All rights reserved.</p></div><div class="flex items-center justify-between"><div class="flex items-center gap-x-4"><a href=https://github.com/Aki-yzh class="transition-all text-muted-foreground hover:text-muted-foreground/75 inline-block" aria-label=github><svg class=size-6><use href=/icons/social.svg#mingcute-github-line></use></svg> </a><a href=/rss.xml class="transition-all text-muted-foreground hover:text-muted-foreground/75 inline-block" aria-label=rss><svg class=size-6><use href=/icons/social.svg#mingcute-rss-2-line></use></svg></a></div></div></div></div></footer></main></body></html>